<div class="d-flex justify-content-between align-items-center mb-3">
  <h1>Todos</h1>
  <%= link_to "New Todo", new_todo_path, class: "btn btn-success" %>
</div>

<p class="text-muted">
  Use the lab marker <code><%= SimulatedInjectionService.delay_marker %></code> in a title to trigger the simulated
  time delay. Suspicious characters like <%= SimulatedInjectionService.filtered_patterns.map { |p| "<code>#{p}</code>" }.join(", ").html_safe %> are filtered instantly.
</p>

<table class="table table-hover">
  <thead>
    <tr>
      <th>Title</th>
      <th>Description</th>
      <th>Completed</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <% @todos.each do |todo| %>
      <tr>
        <td><%= todo.title %></td>
        <td><%= truncate(todo.description, length: 120) %></td>
        <td>
          <% if todo.completed? %>
            <span class="badge bg-success">Done</span>
          <% else %>
            <span class="badge bg-secondary">Open</span>
          <% end %>
        </td>
        <td class="text-end">
          <div class="btn-group btn-group-sm todo-actions" role="group" aria-label="Todo actions">
            <%= link_to "Show", todo, class: "btn btn-soft-primary" %>
            <%= link_to "Edit", edit_todo_path(todo), class: "btn btn-soft-warning" %>
            <%= button_to "Delete", todo, method: :delete, class: "btn btn-soft-danger", data: { turbo_confirm: "Are you sure?" }, form: { class: "d-inline" } %>
          </div>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<% if @todos.empty? %>
  <p class="text-muted">No todos yet. Create one to see the simulation in action.</p>
<% end %>
